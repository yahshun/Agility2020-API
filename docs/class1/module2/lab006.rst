Lab – Implement Rate Limiting
--------------------------------------------

The API Protection profile allows a BIG-IP administrator to throttle the amount of connections to an API through the use of Key Names. 


Task – Update the pre-built Key Names
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. From the Jumpbox, access the BIG-IP GUI https://10.1.1.4 (you can double-click on the BIG-IP1 bookmark from Chrome).

#. Login into the BIG-IP Configuration Utility with the following credentials:
- User: **admin**
- Password: **admin**


#. Click on the **Access** tab located on the left side.

|image0|

#. Navigate to API Protection >> Profile.  Click **Profile** to modify the previously created API protection Profile.  Not the + Plus symbol.

|image48|

#. Click **API-Protection**

|image64|

#. Click **Rate Limiting** from the top ribbon

|image69|

.. Note ::  The API protection profile default settings contains five Key Names created, but their values are empty.  Additional Keys can be created if necessary


#. Click **api-protection_auto_rate_limiting_key1**

|image70| 

#. Enter the Key Value **%{subsession.oauth.scope./Common/as-jwt-provider.jwt.user}**
#. Click **Edit**

|image71|

#. Click **api-protection_auto_rate_limiting_key2**

|image72| 

#. Enter the Key Value **%{subsession.oauth.scope./Common/as-jwt-provider.jwt.groupid}**
#. Click **Edit**

|image73|

#. Click **api-protection_auto_rate_limiting_key3**

|image74| 

#. Enter the Key Value **%{subsession.oauth.scope./Common/as-jwt-provider.jwt.client}**
#. Click **Edit**

|image75|

#. Click **api-protection_auto_rate_limiting_key4**

|image76| 

#. Enter the Key Value **%{subsession.oauth.scope./Common/as-jwt-provider.jwt.tier}**
#. Click **Edit**

|image77|

#. Click **api-protection_auto_rate_limiting_key5**

|image78| 

#. Enter the Key Value **%{subsession.oauth.scope./Common/as-jwt-provider.jwt.org}**
#. Click **Edit**

|image79|

#. Click **Save**

|image80|

Task – Create a Rate Limiting Policy
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. Click **Create** in the rate limiting section

|image81|

#. Enter the Name **acme-rate-limits**
#.  Move all five keys under Selected Kyes
#. Enter 10 for the number of requests per minutes
#. Enter 5 for the number requests per seconds
#. Click Add.

|image82|

#. Click **Save**

|image83|



Task – Apply the Rate Limiting Policy
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Task – Test Rate Limiting
~~~~~~~~~~~~~~~~~~~~~~~~~~~






.. |image0| image:: /_static/class1/module2/image000.png
.. |image23| image:: /_static/class1/module2/image023.png
.. |image26| image:: /_static/class1/module2/image026.png
.. |image27| image:: /_static/class1/module2/image027.png
.. |image28| image:: /_static/class1/module2/image028.png
.. |image29| image:: /_static/class1/module2/image029.png
.. |image34| image:: /_static/class1/module2/image034.png
.. |image39| image:: /_static/class1/module2/image039.png
.. |image43| image:: /_static/class1/module2/image043.png
.. |image44| image:: /_static/class1/module2/image044.png
.. |image45| image:: /_static/class1/module2/image045.png
.. |image46| image:: /_static/class1/module2/image046.png
.. |image47| image:: /_static/class1/module2/image047.png
.. |image48| image:: /_static/class1/module2/image048.png
.. |image49| image:: /_static/class1/module2/image049.png
.. |image50| image:: /_static/class1/module2/image050.png
.. |image51| image:: /_static/class1/module2/image051.png
.. |image52| image:: /_static/class1/module2/image052.png
.. |image53| image:: /_static/class1/module2/image053.png
.. |image54| image:: /_static/class1/module2/image054.png
.. |image55| image:: /_static/class1/module2/image055.png
.. |image56| image:: /_static/class1/module2/image056.png
.. |image57| image:: /_static/class1/module2/image057.png
.. |image58| image:: /_static/class1/module2/image058.png
.. |image59| image:: /_static/class1/module2/image059.png
.. |image60| image:: /_static/class1/module2/image060.png
.. |image61| image:: /_static/class1/module2/image061.png
.. |image62| image:: /_static/class1/module2/image062.png
.. |image63| image:: /_static/class1/module2/image063.png
.. |image64| image:: /_static/class1/module2/image064.png
.. |image65| image:: /_static/class1/module2/image065.png
.. |image66| image:: /_static/class1/module2/image066.png
.. |image67| image:: /_static/class1/module2/image067.png
.. |image68| image:: /_static/class1/module2/image068.png
.. |image69| image:: /_static/class1/module2/image069.png
.. |image70| image:: /_static/class1/module2/image070.png
.. |image71| image:: /_static/class1/module2/image071.png
.. |image72| image:: /_static/class1/module2/image072.png
.. |image73| image:: /_static/class1/module2/image073.png
.. |image74| image:: /_static/class1/module2/image074.png
.. |image75| image:: /_static/class1/module2/image075.png
.. |image76| image:: /_static/class1/module2/image076.png
.. |image77| image:: /_static/class1/module2/image077.png
.. |image78| image:: /_static/class1/module2/image078.png
.. |image79| image:: /_static/class1/module2/image079.png
.. |image80| image:: /_static/class1/module2/image080.png
.. |image81| image:: /_static/class1/module2/image081.png
.. |image82| image:: /_static/class1/module2/image082.png
.. |image83| image:: /_static/class1/module2/image083.png





